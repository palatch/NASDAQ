<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Stock Monitor PWA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(to bottom right, #f5f5f5, #dcdcdc);
      padding: 20px;
      max-width: 500px;
      margin: auto;
    }
    h2, h3 {
      color: #333;
      animation: fadeIn 1s ease-in;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
      font-size: 16px;
    }
    button {
      background: linear-gradient(to right, gold, silver);
      border: none;
      color: #000;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.05);
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin-bottom: 10px;
      background: #fff;
      padding: 10px;
      border-radius: 5px;
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
  </style>
</head>
<body>
  <h2>üìà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à</h2>
  <input type="text" id="symbolInput" placeholder="‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏´‡∏∏‡πâ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô AAPL" />
  <input type="number" id="buyPriceInput" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠" />
  <input type="number" id="tpInput" placeholder="‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡∏≥‡πÑ‡∏£ (TP)" />
  <input type="number" id="slInput" placeholder="‡∏à‡∏∏‡∏î‡∏ï‡∏±‡∏î‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô (SL)" />
  <input type="number" id="sharesInput" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏∏‡πâ‡∏ô" />
  <button onclick="addStock()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏∏‡πâ‡∏ô</button>

  <h3>‚úÖ ‡∏´‡∏∏‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß:</h3>
  <ul id="stockList"></ul>

  <script>
    const API_KEY = 'd24u9h9r01qu2jgk36cgd24u9h9r01qu2jgk36d0';
    const API_ENDPOINT = 'https://finnhub.io/api/v1';

    function loadStocks() {
      const stocks = JSON.parse(localStorage.getItem('stocks') || '[]');
      const stockList = document.getElementById('stockList');
      stockList.innerHTML = '';
      stocks.forEach(stock => {
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${stock.symbol}</strong><br>
          ‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà: ${stock.buyPrice} | TP: ${stock.tp} | SL: ${stock.sl} | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${stock.shares}<br>
          <button onclick="removeStock('${stock.symbol}')">üóëÔ∏è ‡∏•‡∏ö</button>
          <button onclick="showChart('${stock.symbol}')">üìä ‡∏Å‡∏£‡∏≤‡∏ü</button>
        `;
        stockList.appendChild(li);
      });
    }

    function addStock() {
      const symbol = document.getElementById('symbolInput').value.trim().toUpperCase();
      const buyPrice = parseFloat(document.getElementById('buyPriceInput').value);
      const tp = parseFloat(document.getElementById('tpInput').value);
      const sl = parseFloat(document.getElementById('slInput').value);
      const shares = parseInt(document.getElementById('sharesInput').value);

      if (!symbol || isNaN(buyPrice) || isNaN(tp) || isNaN(sl) || isNaN(shares)) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á');
        return;
      }

      let stocks = JSON.parse(localStorage.getItem('stocks') || '[]');
      stocks.push({ symbol, buyPrice, tp, sl, shares });
      localStorage.setItem('stocks', JSON.stringify(stocks));
      loadStocks();
    }

    function removeStock(symbol) {
      let stocks = JSON.parse(localStorage.getItem('stocks') || '[]');
      stocks = stocks.filter(stock => stock.symbol !== symbol);
      localStorage.setItem('stocks', JSON.stringify(stocks));
      loadStocks();
    }

    function checkAlerts() {
      const stocks = JSON.parse(localStorage.getItem('stocks') || '[]');
      stocks.forEach(stock => {
        fetch(`${API_ENDPOINT}/quote?symbol=${stock.symbol}&token=${API_KEY}`)
          .then(res => res.json())
          .then(data => {
            const currentPrice = data.c;
            const feeRate = 0.0025;
            const totalBuy = stock.buyPrice * stock.shares;
            const totalSell = currentPrice * stock.shares;
            const fee = totalSell * feeRate;
            const profit = totalSell - totalBuy - fee;
            alert(`üí∞ ${stock.symbol}: ‡∏Å‡∏≥‡πÑ‡∏£/‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô = ${profit.toFixed(2)} ‡∏ö‡∏≤‡∏ó`);

            if (currentPrice >= stock.tp) {
              alert(`üéØ ${stock.symbol} ‡∏ñ‡∏∂‡∏á TP ‡πÅ‡∏•‡πâ‡∏ß!`);
            } else if (currentPrice <= stock.sl) {
              alert(`‚ö†Ô∏è ${stock.symbol} ‡∏ñ‡∏∂‡∏á SL ‡πÅ‡∏•‡πâ‡∏ß!`);
            }
          });

        fetch(`${API_ENDPOINT}/news-sentiment?symbol=${stock.symbol}&token=${API_KEY}`)
          .then(res => res.json())
          .then(data => {
            const sentiment = data.sentiment;
            if (!sentiment) return;
            const positive = sentiment.positiveScore;
            const negative = sentiment.negativeScore;
            if (positive > negative) {
              alert(`üìà ‡∏Ç‡πà‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á ${stock.symbol} ‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å`);
            } else if (negative > positive) {
              alert(`üìâ ‡∏Ç‡πà‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á ${stock.symbol} ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏ö`);
            } else {
              alert(`‚öñÔ∏è ‡∏Ç‡πà‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á ${stock.symbol} ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏•‡∏≤‡∏á`);
            }
          });

        fetch(`${API_ENDPOINT}/indicator?symbol=${stock.symbol}&resolution=D&indicator=rsi&token=${API_KEY}`)
          .then(res => res.json())
          .then(data => {
            const rsi = data?.rsi?.slice(-1)[0];
            if (rsi > 70) {
              alert(`üìâ RSI ${stock.symbol} ‡∏™‡∏π‡∏á (${rsi}) ‚Üí ‡∏≠‡∏≤‡∏à‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢`);
            } else if (rsi < 30) {
              alert(`üìà RSI ${stock.symbol} ‡∏ï‡πà‡∏≥ (${rsi}) ‚Üí ‡∏≠‡∏≤‡∏à‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏ã‡∏∑‡πâ‡∏≠`);
            }
          });
      });
    }

    function showChart(symbol) {
      const chartUrl = `https://quickchart.io/chart?c={
        type:'line',
        data:{labels:['Mon','Tue','Wed','Thu','Fri'],
        datasets:[{label:'${symbol}',data:[170,172,174,173,175]}]}
      }`;
      const img = document.createElement('img');
      img.src = chartUrl;
      img.style.maxWidth = '100%';
      document.body.appendChild(img);
    }

    window.onload = function() {
      loadStocks();
      checkAlerts();
    };
    setInterval(checkAlerts, 60 * 60 * 1000);
  </script>
</body>
</html>
