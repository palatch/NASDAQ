<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0D1117">
  <title>Dime Logger – Bitkub Theme (PWA)</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script>
    window.FINNHUB_API_KEY = "d24u9h9r01qu2jgk36cgd24u9h9r01qu2jgk36d0";
    window.DEFAULT_SYMBOLS = ["TSLA","AAPL","NVDA","MSFT","GOOGL","TSLS","JEPQ"];
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <style>
    :root {
      --bg: #0D1117; --panel:#0f131a; --line:#1f2632; --text:#E6EDF3; --muted:#9AA4B2;
      --green:#00C087; --red:#F05454;
    }
    body { background:var(--bg); color:var(--text); }
    .card { background:#0f131a; border:1px solid var(--line); border-radius:16px; }
    input, select { background:#0e1420; color:var(--text); border:1px solid var(--line); border-radius:12px; }
    .btn { border-radius:12px; }
    .btn-primary { background:var(--green); color:#062b21; font-weight:700; }
    .pill { background:#0f1726; border:1px solid #223048; border-radius:999px; padding:.35rem .6rem; }
    .header { background:#0c121b; border-bottom:1px solid var(--line); }
    .muted { color:var(--muted); }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="header p-4 sticky top-0 z-30">
    <div class="flex items-center justify-between">
      <div class="font-bold text-lg">Dime Logger — Bitkub</div>
      <div class="text-xs muted" id="lastSync">—</div>
    </div>
    <div class="text-xs muted mt-1">บันทึกซื้อ–ขาย + ราคาจริง (Mobile PWA)</div>
  </header>

  <main class="flex-1 p-4 space-y-4">
    <!-- Watchlist -->
    <section class="card p-4">
      <div class="flex items-center justify-between gap-2">
        <h2 class="font-semibold">ราคาหุ้น (Realtime)</h2>
        <div class="flex gap-2">
          <button id="btnRefresh" class="btn px-3 py-2 bg-[#1f2632] hover:opacity-90">รีเฟรช</button>
          <button id="btnA2HS" class="btn btn-primary px-3 py-2 hidden">ติดตั้งแอป</button>
        </div>
      </div>
      <div class="mt-3 flex gap-2">
        <input id="symbolInput" placeholder="เพิ่มสัญลักษณ์ เช่น TSLA" class="px-3 py-3 flex-1">
        <button id="btnAddSymbol" class="btn btn-primary px-4">เพิ่ม</button>
      </div>
      <div id="watchlist" class="mt-3 grid grid-cols-1 gap-2"></div>
    </section>

    <!-- Quick add trade -->
    <section class="card p-4">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">บันทึกซื้อ–ขาย (Quick Add)</h2>
        <span class="text-xs pill muted">ข้อมูลเก็บในเครื่อง</span>
      </div>
      <div class="grid grid-cols-2 gap-2 mt-3">
        <input id="tradeDate" type="date" title="วันที่">
        <input id="tradeSymbol" placeholder="สัญลักษณ์ เช่น TSLA" title="สัญลักษณ์">
        <select id="tradeSide" title="ฝั่งคำสั่ง">
          <option value="BUY">BUY</option>
          <option value="SELL">SELL</option>
          <option value="DIV">DIV</option>
          <option value="FEE">FEE</option>
          <option value="TAX">TAX</option>
        </select>
        <input id="tradeQty" type="number" step="0.000001" placeholder="จำนวน (หุ้น/หน่วย)" title="จำนวน">
        <input id="tradePrice" type="number" step="0.0001" placeholder="ราคา/หุ้น (USD)" title="ราคา">
        <input id="tradeFee" type="number" step="0.01" placeholder="ค่าธรรมเนียม (USD)" title="ค่าธรรมเนียม">
        <input id="tradeFx" type="number" step="0.0001" placeholder="FX USD→THB (ตัวเลือก)" title="FX">
        <input id="tradeNote" placeholder="หมายเหตุ (ไม่บังคับ)" title="หมายเหตุ">
      </div>
      <div class="mt-3 flex gap-2 flex-wrap">
        <button id="btnAddTrade" class="btn btn-primary px-4 py-2">บันทึก</button>
        <button id="btnExportCsv" class="btn px-3 py-2 bg-[#1f2632] hover:opacity-90">Export CSV</button>
        <button id="btnClearAll" class="btn px-3 py-2" style="background:#2a171a; color:#f2b8b8;">ล้างข้อมูลทั้งหมด</button>
      </div>
      <div class="mt-4">
        <div class="text-sm font-semibold mb-2">นำเข้าจากภาพ (OCR เบต้า)</div>
        <input id="ocrFile" type="file" accept="image/*" class="block text-sm">
        <div id="ocrStatus" class="text-xs muted mt-1"></div>
      </div>
    </section>

    <!-- Portfolio summary + sorting -->
    <section class="card p-4">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold">สรุปพอร์ต & P/L</h2>
        <div class="text-xs muted">คำนวณจากราคาปัจจุบัน · เรียง: ตำแหน่งคงเหลือมากสุด → น้อย</div>
      </div>
      <div id="portfolio" class="mt-3 grid grid-cols-1 gap-3"></div>
    </section>
  </main>

  <footer class="p-4 text-center text-xs muted">
    PWA – ทำงานออฟไลน์บางส่วน · เก็บข้อมูลในเครื่อง · ปลอดภัยไม่ส่งข้อมูลออก
  </footer>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) { window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js')); }
  </script>
</body>
</html>
