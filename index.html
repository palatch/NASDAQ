
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏∏‡πâ‡∏ô TSLA/TSLS + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≥‡πÑ‡∏£</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Tahoma, sans-serif; background: #0d1b2a; color: #e0e0e0; padding: 20px; }
    h1 { color: #00ffff; text-align: center; text-shadow: 0 0 5px #00ffff; }
    .status-box, .graph-line, .box, table { margin: 15px auto; width: 100%; max-width: 700px; }
    .status-box { text-align: center; padding: 10px; border-radius: 8px; }
    .open { background: #004d40; color: #00ffcc; }
    .closed { background: #550000; color: #ff9999; }
    .graph-line { height: 1px; background: linear-gradient(to right, #00ffcc, transparent); }
    .box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; border: 1px solid #555; }
    .buy { background: rgba(255,0,0,0.2); color: #ff6666; }
    .sell { background: rgba(0,255,255,0.2); color: #00e6e6; }
    .wait { background: rgba(255,255,0,0.2); color: #ffcc00; }
    table { border-collapse: collapse; color: #fff; margin-top: 20px; }
    th, td { border: 1px solid #666; padding: 8px; text-align: center; }
    th { background-color: #1a2b3c; }
    button { padding: 5px 10px; margin: 5px; font-weight: bold; }
    .action { margin-top: 10px; }
  </style>
</head>
<body>
<h1>üìà ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏∏‡πâ‡∏ô TSLA ‡πÅ‡∏•‡∏∞ TSLS + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢ (Local)</h1>
<div id="marketStatus" class="status-box">‚è≥ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏•‡∏≤‡∏î...</div>

<div class="box" id="tslaBox">
  <h2>üìå TSLA</h2>
  <div id="tslaPrice">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î...</div>
  <div id="tslaSignal"></div>
  <div id="tslaBudget"></div>
  <div class="action">
    <input type="number" id="tslaQty" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ TSLA">
    <button onclick="logTrade('TSLA')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢ TSLA</button>
  </div>
</div>

<div class="box" id="tslsBox">
  <h2>üìå TSLS</h2>
  <div id="tslsPrice">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡πÇ‡∏´‡∏•‡∏î...</div>
  <div id="tslsSignal"></div>
  <div id="tslsBudget"></div>
  <div class="action">
    <input type="number" id="tslsQty" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢ TSLS">
    <button onclick="logTrade('TSLS')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢ TSLS</button>
  </div>
</div>

<div class="graph-line"></div>
<div class="box">
  <h2>üìã ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</h2>
  <table id="tradeLog">
    <thead>
      <tr>
        <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏´‡∏∏‡πâ‡∏ô</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏£‡∏ß‡∏°</th><th>‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</th><th>‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const apiKey = "d24u9h9r01qu2jgk36cgd24u9h9r01qu2jgk36d0";
const baseUrl = "https://finnhub.io/api/v1/quote?symbol=";
const feeRate = 0.003; // ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 0.3%

function isMarketOpenNY() {
  const now = new Date();
  const parts = new Intl.DateTimeFormat('en-US', {
    timeZone: 'America/New_York', hour: '2-digit', minute: '2-digit', weekday: 'short', hour12: false
  }).formatToParts(now);
  let hour = 0, minute = 0, day = "";
  parts.forEach(p => {
    if (p.type === 'hour') hour = parseInt(p.value);
    if (p.type === 'minute') minute = parseInt(p.value);
    if (p.type === 'weekday') day = p.value;
  });
  const totalMins = hour * 60 + minute;
  const open = 570, close = 960;
  const box = document.getElementById("marketStatus");
  if (["Sat", "Sun"].includes(day) || totalMins < open || totalMins > close) {
    box.className = "status-box closed";
    box.innerHTML = "‚ùå ‡∏ï‡∏•‡∏≤‡∏î‡∏õ‡∏¥‡∏î‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏¥‡∏ß‡∏¢‡∏≠‡∏£‡πå‡∏Å)";
  } else {
    box.className = "status-box open";
    box.innerHTML = "‚úÖ ‡∏ï‡∏•‡∏≤‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏¥‡∏ß‡∏¢‡∏≠‡∏£‡πå‡∏Å)";
  }
}

function fetchData(symbol, boxId, priceId, signalId, budgetId, buy, sell, profit) {
  fetch(`${baseUrl}${symbol}&token=${apiKey}`)
    .then(r => r.json())
    .then(d => {
      const p = parseFloat(d.c);
      document.getElementById(priceId).innerHTML = `üíµ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <b>$${p.toFixed(2)}</b>`;
      const signalBox = document.getElementById(signalId);
      if (p <= buy) {
        signalBox.innerHTML = `üî¥ ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ $${buy} ‚Üí ‡∏Ñ‡∏ß‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ`;
        signalBox.className = "buy";
        alert(`üì¢ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${symbol} ‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!`);
      } else if (p >= sell) {
        signalBox.innerHTML = `üîµ ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ $${sell} ‚Üí ‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ`;
        signalBox.className = "sell";
        alert(`üì¢ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${symbol} ‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`);
      } else {
        signalBox.innerHTML = `‚è≥ ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á $${buy} ‚Äì $${sell} ‚Üí ‡∏£‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞`;
        signalBox.className = "wait";
      }
      const units = Math.ceil(5 / profit);
      const total = (units * p).toFixed(2);
      document.getElementById(budgetId).innerHTML = `üí∞ ‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ‚âà $${total} (${units} ‡∏´‡∏ô‡πà‡∏ß‡∏¢ ‡∏Å‡∏≥‡πÑ‡∏£ ‚â• $5)`;
      localStorage.setItem(symbol + "_price", p);
    });
}

function logTrade(symbol) {
  const qty = parseInt(document.getElementById(symbol.toLowerCase() + "Qty").value);
  if (!qty || qty <= 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
  const p = parseFloat(localStorage.getItem(symbol + "_price"));
  const now = new Date().toLocaleString("th-TH");
  const total = (p * qty).toFixed(2);
  const fee = (p * qty * feeRate).toFixed(2);
  const net = (p * qty * (1 + feeRate)).toFixed(2);
  const row = `<tr><td>${now}</td><td>${symbol}</td><td>$${p.toFixed(2)}</td><td>${qty}</td><td>$${total}</td><td>$${fee}</td><td>$${net}</td></tr>`;
  document.querySelector("#tradeLog tbody").innerHTML += row;
}

isMarketOpenNY();
fetchData("TSLA", "tslaBox", "tslaPrice", "tslaSignal", "tslaBudget", 310, 330, 20);
fetchData("TSLS", "tslsBox", "tslsPrice", "tslsSignal", "tslsBudget", 7.00, 9.50, 2.5);
</script>
</body>
</html>
